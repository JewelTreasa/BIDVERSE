{% extends "base.html" %}
{% block content %}
<section class="section auction-detail" style="padding: 100px 0; background: #f8fafc;">
<div class="container">
<div style="display: grid; grid-template-columns: 1.2fr 1fr; gap: 40px; background: white; padding: 40px; border-radius: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.05);">
<div class="detail-visuals">
<div style="position: relative; border-radius: 20px; overflow: hidden; height: 450px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
<img src="{{ listing.display_image }}" alt="{{ listing.commodity }}" style="width: 100%; height: 100%; object-fit: cover;">
<div style="position: absolute; top: 20px; right: 20px;"><span class="detail-badge">{{ listing.display_label }}</span></div>
</div>
<h2 style="font-family: Playfair Display, serif; font-size: 28px; color: var(--text-dark); margin-bottom: 15px;">Product Description</h2>
<p class="detail-description">{{ listing.clean_description }}</p>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
<div class="detail-info-card"><span class="label-v2" style="display: block; margin-bottom: 5px;">Quantity Available</span><strong class="detail-value">{{ listing.quantity }} {{ listing.unit }}</strong></div>
<div class="detail-info-card"><span class="label-v2" style="display: block; margin-bottom: 5px;">Base Price</span><strong class="detail-value">{{ listing.base_price|floatformat:0 }} / {{ listing.unit }}</strong></div>
</div>
</div>
<div class="detail-actions">
<div style="background: #ffffff; border: 2px solid #f1f5f9; border-radius: 25px; padding: 35px; margin-bottom: 30px; position: sticky; top: 120px;">
<h1 style="font-family: Playfair Display, serif; font-size: 36px; color: var(--text-dark); margin-bottom: 10px;">{{ listing.commodity }}</h1>
<div style="display: flex; align-items: center; gap: 10px; margin-bottom: 25px;"><i class="fas fa-clock" style="color: var(--primary-green);"></i><span style="color: #64748b; font-weight: 500;">{{ listing.time_label }}: <span style="color: var(--text-dark);">{{ listing.display_time }}</span></span></div>
<div class="detail-bid-box"><span class="label-v2" style="display: block; margin-bottom: 8px;">{{ listing.display_label }}</span><div class="bid-price-v2" style="font-size: 48px; letter-spacing: -1px;">{{ listing.display_price }}</div></div>
{% if messages %}{% for message in messages %}<div class="alert {% if message.tags == 'success' %}alert-success{% else %}alert-error{% endif %}" style="margin-bottom: 20px; border-radius: 12px;">{{ message }}</div>{% endfor %}{% endif %}
{% if user.is_authenticated and user.user_type == 'BUYER' %}
<form action="{% url 'place_bid' listing.id %}" method="POST">{% csrf_token %}
<div style="margin-bottom: 25px;"><label style="display: block; margin-bottom: 12px; font-weight: 600; color: var(--text-dark);">Enter Your Bid ()</label><div style="position: relative;"><span style="position: absolute; left: 20px; top: 50%; transform: translateY(-50%); font-size: 20px; font-weight: 600; color: #64748b;"></span><input type="number" name="amount" required step="1" min="{{ listing.display_price }}" style="width: 100%; padding: 18px 18px 18px 45px; border: 2px solid #e2e8f0; border-radius: 15px; font-size: 20px; font-weight: 600;" placeholder="{{ listing.display_price|add:1 }}"></div><p style="color: #64748b; font-size: 14px; margin-top: 10px;"><i class="fas fa-info-circle"></i> Minimum bid required: <strong>{{ listing.display_price }}</strong></p></div>
<button type="submit" class="btn btn-primary btn-block" style="padding: 20px; font-size: 18px; font-weight: 700; border-radius: 15px;">Place Bid Now</button>
</form>
{% elif not user.is_authenticated %}
<a href="{% url 'login' %}?next={{ request.path }}" class="btn btn-primary btn-block" style="padding: 20px; border-radius: 15px;">Login to Participate</a>
{% else %}
<div style="background: #fffbeb; padding: 20px; border-radius: 15px; border: 1px solid #fde68a;"><p style="color: #92400e; font-size: 15px; text-align: center;"><i class="fas fa-exclamation-triangle"></i> Only registered buyers can place bids.</p></div>
{% endif %}
</div>
<div class="bid-history" style="margin-top: 40px;"><div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;"><h3 style="font-family: Playfair Display, serif; font-size: 24px; color: var(--text-dark);">Bid History</h3><span style="font-size: 14px; color: #64748b;">Top 5 Bidders</span></div>
<div style="display: grid; gap: 15px;">{% for bid in bid_history %}<div style="display: flex; justify-content: space-between; align-items: center; padding: 18px 25px; background: #ffffff; border: 1px solid #f1f5f9; border-radius: 15px;"><div style="display: flex; align-items: center; gap: 15px;"><div style="width: 40px; height: 40px; background: #f1f5f9; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--primary-green);"><i class="fas fa-user"></i></div><div><div style="font-weight: 600; color: var(--text-dark);">{{ bid.buyer.get_full_name|default:bid.buyer.email }}</div><div style="font-size: 12px; color: #94a3b8;">{{ bid.timestamp|date:"M d, H:i" }}</div></div></div><strong style="color: var(--primary-green); font-size: 18px;">{{ bid.amount }}</strong></div>{% empty %}<div style="text-align: center; padding: 40px; background: #f8fafc; border-radius: 20px; border: 2px dashed #e2e8f0;"><p style="color: #94a3b8; font-size: 16px;">No bids placed yet. Be the first to bid!</p></div>{% endfor %}</div>
</div>
</div>
</div>
</div>
</section>
{% endblock %}