{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    body {
        background-color: #f1f5f9;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    .checkout-container {
        max-width: 1100px;
        margin: 5rem auto;
    }

    .checkout-card {
        background: #fff;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        border: 1px solid #e2e8f0;
        overflow: hidden;
        display: flex;
        flex-wrap: wrap;
        min-height: 600px;
    }

    /* Left Side: Order Summary */
    .summary-side {
        flex: 1.2;
        min-width: 450px;
        padding: 4rem 5rem;
        background-color: #f8fafc;
        border-right: 1px solid #e2e8f0;
    }

    /* Right Side: Payment Info */
    .payment-side {
        flex: 1;
        min-width: 350px;
        padding: 4rem 5rem;
        background-color: #ffffff;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .section-title {
        font-size: 1.75rem;
        font-weight: 800;
        color: #0f172a;
        margin-bottom: 3rem;
        letter-spacing: -0.02em;
    }

    .order-item {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 2rem;
        color: #475569;
    }

    .order-item.total {
        margin-top: 3rem;
        padding-top: 2rem;
        border-top: 2px solid #e2e8f0;
        color: #0f172a;
        font-weight: 800;
        font-size: 1.5rem;
    }

    .btn-pay-action {
        width: 100%;
        height: 64px;
        background-color: #0f172a;
        color: #fff;
        border: none;
        border-radius: 12px;
        font-size: 1.15rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        transition: all 0.2s ease;
        margin-bottom: 2rem;
        cursor: pointer;
    }

    .btn-pay-action:hover {
        background-color: #1e293b;
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(15, 23, 42, 0.15);
    }

    .btn-pay-action.yearly {
        background-color: #15803d;
    }
    
    .btn-pay-action.yearly:hover {
        background-color: #166534;
    }

    .back-link {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #64748b;
        text-decoration: none;
        font-size: 1rem;
        font-weight: 600;
        transition: color 0.2s;
    }

    .back-link:hover {
        color: #0f172a;
    }

    .trust-footer {
        margin-top: 3rem;
        display: flex;
        align-items: center;
        gap: 12px;
        color: #94a3b8;
        font-size: 0.9rem;
        font-weight: 500;
    }

    @media (max-width: 992px) {
        .checkout-card { flex-direction: column; }
        .summary-side { border-right: none; border-bottom: 1px solid #e2e8f0; padding: 3rem; }
        .payment-side { padding: 3rem; }
    }
</style>

<div class="checkout-container">
    <div class="checkout-card">
        <!-- Order Summary Side -->
        <div class="summary-side">
            <h2 class="section-title">Order Summary</h2>
            
            <div class="order-item">
                <div class="d-flex flex-column gap-1">
                    <span class="fs-5 fw-bold text-dark">{{ plan_type|title }} Access</span>
                    <span class="text-muted" style="max-width: 300px;">Full platform access for one {% if plan_type == 'yearly' %}year{% else %}month{% endif %}.</span>
                </div>
                <span class="fs-4 fw-bold text-dark">₹{{ amount }}</span>
            </div>

            <div class="order-item">
                <span class="fw-medium">Subtotal</span>
                <span class="fw-semibold">₹{{ amount }}</span>
            </div>
            
            <div class="order-item">
                <span class="fw-medium">Tax (GST 0%)</span>
                <span class="fw-semibold">₹0</span>
            </div>

            <div class="order-item total">
                <span>Total Due</span>
                <span>₹{{ amount }}</span>
            </div>
        </div>

        <!-- Payment Info Side -->
        <div class="payment-side">
            <h2 class="section-title">Payment Details</h2>

            {% if mock_payment %}
                <div class="alert alert-secondary border-0 mb-4" style="background: #f1f5f9; border-radius: 8px;">
                    <p class="small text-muted mb-1"><i class="fas fa-info-circle me-1"></i> Testing Mode</p>
                    <p class="small text-dark fw-medium mb-0">This is a simulation. Click below to verify the flow.</p>
                </div>
                
                <a href="{% url 'payment_success' %}?plan_type={{ plan_type }}&mock_payment=true" class="btn-pay-action {% if plan_type == 'yearly' %}yearly{% endif %} text-decoration-none">
                    Complete Transaction <i class="fas fa-arrow-right"></i>
                </a>
            {% else %}
                <button id="rzp-button1" class="btn-pay-action {% if plan_type == 'yearly' %}yearly{% endif %}">
                    Pay Securely with Razorpay <i class="fas fa-lock"></i>
                </button>
            {% endif %}

            <div class="text-center">
                <p class="small text-muted mb-4">You will be redirected to a secure payment gateway to complete your transaction.</p>
                
                <div class="d-flex justify-content-center gap-3 opacity-50 mb-4">
                    <i class="fab fa-cc-visa fs-4"></i>
                    <i class="fab fa-cc-mastercard fs-4"></i>
                    <i class="fas fa-university fs-4"></i>
                </div>

                <a href="{% url 'membership_plans' %}" class="back-link justify-content-center">
                    <i class="fas fa-chevron-left"></i> Go Back or Cancel
                </a>
            </div>

            <div class="trust-footer">
                <i class="fas fa-shield-check text-success"></i>
                <span>Secure 256-bit SSL Encrypted Payment</span>
            </div>
        </div>
    </div>

    <div class="text-center mt-4">
        <p class="text-muted small">Need help? <a href="{% url 'contact' %}" class="text-dark fw-semibold text-decoration-none">Contact Support</a></p>
    </div>
</div>



{% if not mock_payment %}
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
var options = {
    "key": "{{ api_key }}", // Enter the Key ID generated from the Dashboard
    "amount": "{{ order_amount }}", // Amount is in currency subunits. Default currency is INR.
    "currency": "{{ currency }}",
    "name": "BidVerse",
    "description": "{{ plan_type|title }} Membership",
    "image": "https://example.com/your_logo", 
    "order_id": "{{ order_id }}", 
    "handler": function (response){
        // Only redirect on success
        window.location.href = "{% url 'payment_success' %}?razorpay_payment_id=" + response.razorpay_payment_id + "&razorpay_order_id=" + response.razorpay_order_id + "&razorpay_signature=" + response.razorpay_signature + "&plan_type={{ plan_type }}";
    },
    "prefill": {
        "name": "{{ request.user.get_full_name|default:request.user.username }}",
        "email": "{{ request.user.email }}",
        "contact": "{{ request.user.phone|default:'9999999999' }}"
    },
    "theme": {
        "color": "{% if plan_type == 'yearly' %}#F59E0B{% else %}#166534{% endif %}"
    },
    "modal": {
        "ondismiss": function(){
            console.log('Checkout form closed');
        }
    }
};

var rzp1 = new Razorpay(options);
rzp1.on('payment.failed', function (response){
        alert(response.error.description);
});

document.getElementById('rzp-button1').onclick = function(e){
    rzp1.open();
    e.preventDefault();
}
</script>
{% endif %}
{% endblock %}
