{% extends 'base.html' %}
{% load static %}

{% block title %}BidVerse - Agricultural Commodity Online Auction System{% endblock %}

{% block extra_head %}
<!-- Font Awesome for Icons (also in base, but index had it specifically, maybe for newer version? Base has 6.4.0. Index had 6.4.0. Redundant but harmless, I'll skip it as base has it). -->
<link rel="stylesheet" href="/assets/css/chatbot.css">
<style>
    /* Homepage specific overrides */
    
    /* Fixed Navbar with transition */
    .navbar {
        background-color: transparent !important;
        box-shadow: none !important;
        position: fixed !important;
        width: 100%;
        top: 0;
        left: 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        z-index: 1000;
    }

    /* Scrolled State */
    .navbar.scrolled {
        background-color: #ffffff !important;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1) !important;
        border-bottom: none;
        padding-top: 10px;
        padding-bottom: 10px;
    }
    
    /* Default dark mode links (when NOT scrolled) */
    .navbar:not(.scrolled) .nav-links a {
        color: rgba(255, 255, 255, 0.9) !important;
    }
    
    .navbar:not(.scrolled) .nav-links a:hover {
        color: #bef264 !important;
    }
    
    .navbar:not(.scrolled) .logo {
        color: white !important;
    }
    
    /* Logo overrides only when NOT scrolled */
    .navbar:not(.scrolled) .logo-icon path[fill="#2e7d32"] {
        fill: #bef264 !important;
    }
    
    .navbar:not(.scrolled) .logo-icon path[fill="#1b5e20"] {
        fill: #bef264 !important;
    }
    
    .navbar:not(.scrolled) .logo-icon circle {
        fill: #bef264 !important;
    }

    .navbar:not(.scrolled) .logo .highlight {
        color: #bef264 !important;
    }

    .navbar:not(.scrolled) .user-name-nav {
        color: white !important;
    }

    .navbar:not(.scrolled) .mobile-menu-btn {
        color: white !important;
    }

    .navbar:not(.scrolled) .profile-icon-btn {
        color: #bef264 !important;
    }

    /* Scrolled state overrides (Light background, dark text) */
    .navbar.scrolled .nav-links a {
        color: #1a2e05 !important;
    }
    
    .navbar.scrolled .nav-links a:hover {
        color: #2e7d32 !important;
    }

    .navbar.scrolled .logo {
        color: #1a2e05 !important;
    }

    .navbar.scrolled .user-name-nav {
        color: #1a2e05 !important;
    }

    .navbar.scrolled .mobile-menu-btn {
        color: #1a2e05 !important;
    }

    .navbar.scrolled .profile-icon-btn {
        color: #1a2e05 !important;
    }

    /* Redesigned Hero Section with Slider */
    .hero-section {
        height: 100vh;
        min-height: 700px;
        padding: 0;
        display: flex;
        align-items: center;
        position: relative;
        overflow: hidden;
    }

    .hero-slider {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
    }

    .hero-slide {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        opacity: 0;
        transition: opacity 1.5s ease-in-out;
        filter: contrast(110%) brightness(95%) saturate(110%);
    }

    .hero-slide.active {
        opacity: 1;
    }

    .hero-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(rgba(0, 0, 0, 0.01), rgba(0, 0, 0, 0.05));
        z-index: 1;
    }


    .hero-container {
        position: relative;
        z-index: 2;
        width: 100%;
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 2rem;
    }

    .hero-content {
        max-width: 700px;
        padding-top: 60px; /* Offset for fixed navbar */
    }

    .hero-content h1 {
        font-family: 'Outfit', sans-serif !important;
        font-size: clamp(3rem, 5vw, 4.5rem);
        font-weight: 700;
        line-height: 1.1;
        color: white;
        margin-bottom: 1.5rem;
    }

    .hero-content h1 .highlight {
        color: #bef264; /* Lime green */
    }

    .hero-content p {
        font-size: 1.25rem;
        color: rgba(255, 255, 255, 0.9);
        margin-bottom: 2.5rem;
        max-width: 600px;
    }

    .hero-actions {
        display: flex;
        gap: 1rem;
    }

    .btn-lime {
        background-color: #bef264;
        color: #1a2e05;
        padding: 16px 36px;
        border-radius: 50px;
        font-weight: 600;
        font-size: 1.1rem;
        transition: all 0.3s ease;
        border: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        text-decoration: none;
    }

    .btn-lime:hover {
        background-color: #a3e635;
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(163, 230, 53, 0.3);
    }
    
    /* Active Link styling for Home */
    .nav-links a[href="/"] {
        position: relative;
        color: #bef264 !important;
    }
    
    .nav-links a[href="/"]::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 20px;
        height: 2px;
        background-color: #bef264;
    }
</style>
{% endblock %}

{% block content %}
    <!-- Hero Section with Slider -->
    <section class="hero-section">
        <div class="hero-slider">
            <div class="hero-slide active" style="background-image: url('/assets/images/hero_spices_dark_spoons.jpg');">
                <div class="hero-overlay"></div>
            </div>
            <div class="hero-slide" style="background-image: url('/assets/images/hero_rice_new.jpg');">
                <div class="hero-overlay"></div>
            </div>
            <div class="hero-slide" style="background-image: url('/assets/images/hero_maize_new.jpg');">
                <div class="hero-overlay"></div>
            </div>
        </div>
        <div class="hero-container">
            <div class="hero-content">
                <h1>Shaping the future of the <span class="highlight">fresh produce</span> industry</h1>
                <p>AgriTech software solutions, custom-built for your fresh produce business to ensure transparency and fair pricing.</p>
                <div class="hero-actions">
                    <a href="{% url 'register' %}" class="btn btn-lime">Get Started</a>
                </div>
            </div>
        </div>
    </section>

    <!-- How It Works -->
    <section class="section how-it-works" id="how-it-works">
        <div class="container">
            <div class="section-header">
                <h2>How It Works</h2>
                <p>Simple steps to start trading securely</p>
            </div>
            <div class="steps-grid">
                <div class="step-card">
                    <div class="step-icon"><i class="fas fa-user-plus"></i></div>
                    <h3>1. Register</h3>
                    <p>Sign up as a Farmer or Buyer. Verify your identity to ensure a safe trading environment.</p>
                </div>
                <div class="step-card">
                    <div class="step-icon"><i class="fas fa-gavel"></i></div>
                    <h3>2. List or Bid</h3>
                    <p>Sellers list commodities with base prices. Buyers place bids in real-time auctions.</p>
                </div>
                <div class="step-card">
                    <div class="step-icon"><i class="fas fa-handshake"></i></div>
                    <h3>3. Trade Securely</h3>
                    <p>Highest bidder wins. Secure payments and transparent history ensure trust.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Live Auction Previews -->
    <section class="section auctions" id="auctions">
        <div class="container">
            <div class="section-header">
                <h2>Live Auctions</h2>
                <p>Bid on high-quality produce happening now</p>
                <a href="{% url 'marketplace' %}" class="view-all">View All Auctions <i
                        class="fas fa-arrow-right"></i></a>
            </div>
            <div class="auction-grid">
                {% for auction in latest_auctions %}
                <div class="auction-card" data-listing-id="{{ auction.id }}"
                    data-start-time="{{ auction.start_time|date:'c' }}" data-end-time="{{ auction.end_time|date:'c' }}">
                    <div class="card-image">
                        <img src="{{ auction.display_image }}" alt="{{ auction.commodity }}">
                        <span class="badge live {% if auction.start_time > now %}hidden{% endif %}">Live</span>
                        <span
                            class="badge upcoming bg-upcoming {% if auction.start_time <= now %}hidden{% endif %}">Upcoming</span>
                    </div>
                    <div class="card-content">
                        <h3>{{ auction.commodity }}</h3>
                        <p class="location"><i class="fas fa-layer-group"></i> {{ auction.quantity }} {{ auction.unit }}
                        </p>
                        <div class="bid-info-master">
                            <div class="bid-row margin-bottom">
                                <span class="bid-label-v2">{{ auction.display_label }}</span>
                                <span class="bid-price-v2 bid-price-dark">â‚¹{{ auction.display_price }}/{{ auction.unit }}</span>
                            </div>
                            <div class="bid-row">
                                <span class="bid-label-v2">{{ auction.time_label }}</span>
                                <span class="bid-time-v2">{{ auction.display_time }}</span>
                            </div>
                        </div>
                        <div class="card-actions">
                            {% if user.is_authenticated and user.user_type == 'FARMER' %}
                            <a href="{% url 'auction_detail' auction.id %}"
                                class="btn btn-outline btn-block {% if auction.start_time > now %}hidden{% endif %}"
                                style="display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-eye" style="margin-right: 5px;"></i> View Details
                            </a>
                            {% else %}
                            <a href="{% url 'auction_detail' auction.id %}"
                                class="btn btn-primary btn-block bid-btn {% if auction.start_time > now %}hidden{% endif %}">Place
                                Bid</a>
                            {% endif %}
                            
                            <!-- Upcoming Actions: Side by Side -->
                            <div class="upcoming-actions {% if auction.start_time <= now %}hidden{% endif %}" style="display: flex; gap: 10px; width: 100%;">
                                {% if not user.is_authenticated or user.user_type == 'BUYER' %}
                                    {% if not auction.is_subscribed %}
                                    <button
                                        class="btn btn-outline notify-btn"
                                        onclick="toggleNotify(this)" data-listing-id="{{ auction.id }}"
                                        data-subscribed="false"
                                        style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 10px 5px; font-size: 0.9rem;">
                                        <i class="far fa-bell" style="margin-right: 5px;"></i> Notify Me
                                    </button>
                                    {% endif %}
                                {% endif %}
                                <a href="{% url 'auction_detail' auction.id %}"
                                    class="btn btn-outline"
                                    style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 10px 5px; font-size: 0.9rem;">
                                    <i class="fas fa-eye" style="margin-right: 5px;"></i> View Details
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="no-auctions">
                    <p>No active auctions at the moment. Check back soon!</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <!-- Why Choose Us -->
    <section class="section features bg-light" id="features">
        <div class="container">
            <div class="section-header">
                <h2>Why Choose BidVerse?</h2>
                <p>Empowering agriculture with technology and trust</p>
            </div>
            <div class="features-grid">
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-shield-alt"></i></div>
                    <h4>Verified Farmers</h4>
                    <p>All sellers pass KYC verification to ensure genuine quality produce.</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-chart-line"></i></div>
                    <h4>Fair Pricing</h4>
                    <p>Competitive bidding ensures farmers get the true market value.</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-lock"></i></div>
                    <h4>Secure Payments</h4>
                    <p>Escrow-like payment systems protect both buyers and sellers.</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-search-dollar"></i></div>
                    <h4>Transparent Bidding</h4>
                    <p>Real-time updates and complete bid history for full transparency.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Featured Commodities -->
    <section class="section commodities">
        <div class="container">
            <div class="section-header">
                <h2>Featured Commodities</h2>
                <p>Explore wide ranges of agricultural products</p>
            </div>
            <div class="commodities-gallery">
                <div class="commodity-item item-1">
                    <div class="overlay">
                        <h3>Grains</h3>
                        <p>Wheat, Rice, Maize</p>
                    </div>
                </div>
                <div class="commodity-item item-2">
                    <div class="overlay">
                        <h3>Spices</h3>
                        <p>Cardamom, Pepper, Turmeric</p>
                    </div>
                </div>
                <div class="commodity-item item-3">
                    <div class="overlay">
                        <h3>Pulses</h3>
                        <p>Lentils, Chickpeas</p>
                    </div>
                </div>
                <div class="commodity-item item-4">
                    <div class="overlay">
                        <h3>Fruits & Vegetables</h3>
                        <p>Tomato, Potato, Onion</p>
                    </div>
                </div>
                <div class="commodity-item item-5">
                    <div class="overlay">
                        <h3>Plantation</h3>
                        <p>Rubber, Cotton, Tea</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Testimonials -->
    <section class="section testimonials bg-light">
        <div class="container">
            <div class="section-header">
                <h2>Farmer Success Stories</h2>
            </div>
            <div class="testimonials-grid">
                <div class="testimonial-card">
                    <p class="quote">"BidVerse helped me get 20% more for my wheat harvest than the local mandi. The
                        process was transparent and payment was fast."</p>
                    <div class="user-info">
                        <div class="avatar"><i class="fas fa-user-circle"></i></div>
                        <div>
                            <h5>Rajesh Kumar</h5>
                            <span>Farmer, Punjab</span>
                        </div>
                    </div>
                </div>
                <div class="testimonial-card">
                    <p class="quote">"As a wholesale buyer, finding quality spices was hard. BidVerse connects me
                        directly to verified growers in Kerala."</p>
                    <div class="user-info">
                        <div class="avatar"><i class="fas fa-user-circle"></i></div>
                        <div>
                            <h5>Anita Desai</h5>
                            <span>Trader, Mumbai</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>



{% endblock %}

{% block extra_scripts %}
    <!-- Index specific scripts -->
    <script>
        // Navbar scroll effect
        window.addEventListener('scroll', function() {
            const navbar = document.querySelector('.navbar');
            if (navbar) {
                if (window.scrollY > 50) {
                    navbar.classList.add('scrolled');
                } else {
                    navbar.classList.remove('scrolled');
                }
            }
        });

        // Hero Slider Logic
        function initHeroSlider() {
            const slides = document.querySelectorAll('.hero-slide');
            if (slides.length <= 1) return;

            let currentSlide = 0;
            const slideInterval = 5000; // 5 seconds

            function nextSlide() {
                slides[currentSlide].classList.remove('active');
                currentSlide = (currentSlide + 1) % slides.length;
                slides[currentSlide].classList.add('active');
            }

            setInterval(nextSlide, slideInterval);
        }

        document.addEventListener('DOMContentLoaded', initHeroSlider);

        function toggleNotify(btn) {
            const listingId = btn.dataset.listingId;
            fetch(`/listing/${listingId}/notify/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                    'Content-Type': 'application/json'
                }
            })
                .then(response => {
                    if (response.status === 403) {
                        alert("Please log in as a Buyer to subscribe or ensure your account type is correct.");
                        return null;
                    }
                    return response.json();
                })
                .then(data => {
                    if (!data) return;
                    if (data.subscribed) {
                        // Button goes and only show the view details
                        btn.style.display = 'none';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    window.location.href = '/login/';
                });
        }

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
{% endblock %}
