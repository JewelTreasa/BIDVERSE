<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BidVerse - Agricultural Commodity Online Auction System</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="container nav-container">
            <a href="/" class="logo">
                <svg class="logo-icon" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 5C20 5 12 10 12 20C12 25 16 30 20 32C24 30 28 25 28 20C28 10 20 5 20 5Z" fill="#2e7d32"
                        fill-opacity="0.15" />
                    <path d="M20 5C20 5 28 10 28 20C28 25 24 30 20 32V5Z" fill="#2e7d32" />
                    <path d="M20 18L28 18L28 22L20 22L20 18Z" fill="#1b5e20" />
                    <rect x="18" y="15" width="4" height="12" rx="2" fill="#1b5e20" />
                    <circle cx="20" cy="35" r="2" fill="#2e7d32" />
                </svg>
                <span>Bid<span class="highlight">Verse</span></span>
            </a>
            <div class="nav-links">
                <a href="#how-it-works">How It Works</a>
                <a href="#auctions">Auctions</a>
                <a href="#features">Features</a>
                <a href="/contact/">Contact</a>
            </div>
            <div class="nav-buttons">
                <!-- prettier-ignore -->
                {% if user.is_authenticated %}
                <span class="user-name-nav">Hi, {{ user.first_name }}</span>
                <div class="profile-dropdown">
                    <button class="profile-icon-btn" onclick="toggleProfileDropdown()" aria-label="Profile">
                        <i class="fas fa-user-circle"></i>
                    </button>
                    <div class="dropdown-menu" id="profileDropdown">
                        <div class="dropdown-header">
                            <span class="user-name">{{ user.first_name }} {{ user.last_name }}</span>
                            <span class="user-email">{{ user.email }}</span>
                        </div>
                        <a href="{% url 'dashboard' %}" class="dropdown-item">
                            <i class="fas fa-columns"></i> Dashboard
                        </a>
                        <a href="{% url 'logout' %}" class="dropdown-item">
                            <i class="fas fa-sign-out-alt"></i> Log Out
                        </a>
                    </div>
                </div>
                <!-- prettier-ignore -->
                {% else %}
                <a href="{% url 'login' %}" class="btn btn-outline">Log In</a>
                <a href="{% url 'register' %}" class="btn btn-primary">Get Started</a>
                {% endif %}
            </div>
            <button class="mobile-menu-btn"><i class="fas fa-bars"></i></button>
        </div>
    </nav>

    <section class="hero-section">
        <div class="hero-background">
            <img src="{% static 'images/hero.jpg' %}" alt="Agricultural Farmland">
            <div class="hero-overlay"></div>
        </div>

        <div class="container hero-container">
            <div class="hero-content">
                <div class="hero-badge">Transparent Marketplace</div>
                <h1>Sell & Buy Agricultural Commodities Through <span class="highlight">Smart Auctions</span></h1>
                <p>The fairest, most transparent marketplace for farmers, traders, and buyers. Connect directly, bid in
                    real-time, and get the best value for your produce.</p>
                <div class="hero-buttons">
                    <a href="{% url 'register' %}" class="btn btn-primary">Start Selling</a>
                    <a href="{% url 'marketplace' %}" class="btn btn-secondary">Browse Auctions</a>
                </div>
            </div>
        </div>
    </section>

    <!-- How It Works -->
    <section class="section how-it-works" id="how-it-works">
        <div class="container">
            <div class="section-header">
                <h2>How It Works</h2>
                <p>Simple steps to start trading securely</p>
            </div>
            <div class="steps-grid">
                <div class="step-card">
                    <div class="step-icon"><i class="fas fa-user-plus"></i></div>
                    <h3>1. Register</h3>
                    <p>Sign up as a Farmer or Buyer. Verify your identity to ensure a safe trading environment.</p>
                </div>
                <div class="step-card">
                    <div class="step-icon"><i class="fas fa-gavel"></i></div>
                    <h3>2. List or Bid</h3>
                    <p>Sellers list commodities with base prices. Buyers place bids in real-time auctions.</p>
                </div>
                <div class="step-card">
                    <div class="step-icon"><i class="fas fa-handshake"></i></div>
                    <h3>3. Trade Securely</h3>
                    <p>Highest bidder wins. Secure payments and transparent history ensure trust.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Live Auction Previews -->
    <section class="section auctions" id="auctions">
        <div class="container">
            <div class="section-header">
                <h2>Live Auctions</h2>
                <p>Bid on high-quality produce happening now</p>
                <a href="{% url 'marketplace' %}" class="view-all">View All Auctions <i
                        class="fas fa-arrow-right"></i></a>
            </div>
            <div class="auction-grid">
                {% for auction in latest_auctions %}
                <div class="auction-card" data-listing-id="{{ auction.id }}"
                    data-start-time="{{ auction.start_time|date:'c' }}" data-end-time="{{ auction.end_time|date:'c' }}">
                    <div class="card-image">
                        <img src="{{ auction.display_image }}" alt="{{ auction.commodity }}">
                        <span class="badge live {% if auction.start_time > now %}hidden{% endif %}">Live</span>
                        <span
                            class="badge upcoming bg-upcoming {% if auction.start_time <= now %}hidden{% endif %}">Upcoming</span>
                    </div>
                    <div class="card-content">
                        <h3>{{ auction.commodity }}</h3>
                        <p class="location"><i class="fas fa-layer-group"></i> {{ auction.quantity }} {{ auction.unit }}
                        </p>
                        <div class="bid-info-master">
                            <div class="bid-row margin-bottom">
                                <!-- prettier-ignore -->
                                <span class="bid-label-v2">{{ auction.display_label }}</span>
                                <!-- prettier-ignore -->
                                <span class="bid-price-v2 bid-price-dark">â‚¹{{ auction.display_price }}</span>
                            </div>
                            <div class="bid-row">
                                <!-- prettier-ignore -->
                                <span class="bid-label-v2">{{ auction.time_label }}</span>
                                <!-- prettier-ignore -->
                                <span class="bid-time-v2">{{ auction.display_time }}</span>
                            </div>
                        </div>
                        <div class="card-actions">
                            <a href="{% url 'auction_detail' auction.id %}"
                                class="btn btn-primary btn-block bid-btn {% if auction.start_time > now %}hidden{% endif %}">Place
                                Bid</a>
                            <button
                                class="btn btn-outline btn-block notify-btn {% if auction.start_time <= now %}hidden{% endif %}"
                                onclick="toggleNotify(this)" data-listing-id="{{ auction.id }}"
                                data-subscribed="{{ auction.is_subscribed|yesno:'true,false' }}">
                                <!-- prettier-ignore -->
                                {% if auction.is_subscribed %}
                                <i class="fas fa-bell"></i> Subscribed
                                {% else %}
                                <i class="far fa-bell"></i> Notify Me
                                {% endif %}
                            </button>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="no-auctions">
                    <p>No active auctions at the moment. Check back soon!</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <script>
        function toggleNotify(btn) {
            const listingId = btn.dataset.listingId;
            fetch(`/listing/${listingId}/notify/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                    'Content-Type': 'application/json'
                }
            })
                .then(response => {
                    if (response.status === 403) {
                        alert("Please log in as a Buyer to subscribe or ensure your account type is correct.");
                        return null;
                    }
                    return response.json();
                })
                .then(data => {
                    if (!data) return;
                    if (data.subscribed) {
                        btn.innerHTML = '<i class="fas fa-bell"></i> Subscribed';
                        btn.classList.add('subscribed');
                    } else {
                        btn.innerHTML = '<i class="far fa-bell"></i> Notify Me';
                        btn.classList.remove('subscribed');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    window.location.href = '/login/';
                });
        }

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>

    <!-- Why Choose Us -->
    <section class="section features bg-light" id="features">
        <div class="container">
            <div class="section-header">
                <h2>Why Choose BidVerse?</h2>
                <p>Empowering agriculture with technology and trust</p>
            </div>
            <div class="features-grid">
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-shield-alt"></i></div>
                    <h4>Verified Farmers</h4>
                    <p>All sellers differ KYC verification to ensure genuine quality produce.</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-chart-line"></i></div>
                    <h4>Fair Pricing</h4>
                    <p>Competitive bidding ensures farmers get the true market value.</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-lock"></i></div>
                    <h4>Secure Payments</h4>
                    <p>Escrow-like payment systems protect both buyers and sellers.</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-search-dollar"></i></div>
                    <h4>Transparent Bidding</h4>
                    <p>Real-time updates and complete bid history for full transparency.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Featured Commodities -->
    <section class="section commodities">
        <div class="container">
            <div class="section-header">
                <h2>Featured Commodities</h2>
                <p>Explore wide ranges of agricultural products</p>
            </div>
            <div class="commodities-gallery">
                <div class="commodity-item item-1">
                    <div class="overlay">
                        <h3>Grains</h3>
                        <p>Wheat, Rice, Maize</p>
                    </div>
                </div>
                <div class="commodity-item item-2">
                    <div class="overlay">
                        <h3>Spices</h3>
                        <p>Cardamom, Pepper, Turmeric</p>
                    </div>
                </div>
                <div class="commodity-item item-3">
                    <div class="overlay">
                        <h3>Pulses</h3>
                        <p>Lentils, Chickpeas</p>
                    </div>
                </div>
                <div class="commodity-item item-4">
                    <div class="overlay">
                        <h3>Cash Crops</h3>
                        <p>Rubber, Cotton, Tea</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Testimonials -->
    <section class="section testimonials bg-light">
        <div class="container">
            <div class="section-header">
                <h2>Farmer Success Stories</h2>
            </div>
            <div class="testimonials-grid">
                <div class="testimonial-card">
                    <p class="quote">"BidVerse helped me get 20% more for my wheat harvest than the local mandi. The
                        process was transparent and payment was fast."</p>
                    <div class="user-info">
                        <div class="avatar"><i class="fas fa-user-circle"></i></div>
                        <div>
                            <h5>Rajesh Kumar</h5>
                            <span>Farmer, Punjab</span>
                        </div>
                    </div>
                </div>
                <div class="testimonial-card">
                    <p class="quote">"As a wholesale buyer, finding quality spices was hard. BidVerse connects me
                        directly to verified growers in Kerala."</p>
                    <div class="user-info">
                        <div class="avatar"><i class="fas fa-user-circle"></i></div>
                        <div>
                            <h5>Anita Desai</h5>
                            <span>Trader, Mumbai</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="cta-section">
        <div class="container cta-content">
            <h2>Join the Agricultural Marketplace of the Future</h2>
            <p>Start trading with confidence today.</p>
            <div class="cta-buttons">
                <a href="/register/" class="btn btn-light btn-lg">Sign Up Now</a>
                <a href="/contact/" class="btn btn-outline-light btn-lg">Contact Sales</a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <a href="#" class="logo footer-logo">Bid<span class="highlight">Verse</span></a>
                    <p>Empowering farmers and buyers with a digital, transparent, and fair auction platform.</p>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="#how-it-works">How It Works</a></li>
                        <li><a href="#auctions">Auctions</a></li>
                        <li><a href="#features">Features</a></li>
                        <li><a href="#about">About Us</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="/contact/">Contact Us</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Connect With Us</h4>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 BidVerse. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- BidVerse Scripts -->
    <script src="{% static 'js/script.js' %}?v=1.1"></script>
</body>

</html>