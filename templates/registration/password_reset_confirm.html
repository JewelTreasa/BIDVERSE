{% extends "base.html" %}

{% block title %}Set New Password - BidVerse{% endblock %}

{% block content %}
<section class="section bg-light">
  <div class="container">
    <div class="text-center" style="max-width: 600px; margin: 0 auto;">
      <!-- Icon -->
      <div style="display: inline-flex; align-items: center; justify-content: center; width: 80px; height: 80px; background-color: var(--primary-light); border-radius: 50%; margin-bottom: 2rem;">
        <i class="fas fa-lock" style="font-size: 2rem; color: var(--primary-dark);"></i>
      </div>

      <h1 style="font-family: 'Playfair Display', serif; font-size: 2.5rem; color: var(--text-dark); margin-bottom: 1rem;">Set New Password</h1>
      <p style="color: var(--text-gray); font-size: 1.1rem; margin-bottom: 3rem;">
        Enter your new password below to complete the reset process.
      </p>
    </div>

    <div style="max-width: 500px; margin: 0 auto;">
      <div style="background: var(--white); padding: 3rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);">

        {% if validlink %}
          <form method="post">
            {% csrf_token %}

            {% if form.new_password1.errors or form.new_password2.errors %}
              <div style="background-color: #fee; border: 1px solid #fcc; color: #c33; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                {% for field in form %}
                  {% for error in field.errors %}
                    <p style="margin: 0 0 0.5rem 0; font-size: 0.9rem;">{{ error }}</p>
                  {% endfor %}
                {% endfor %}
                {% if form.non_field_errors %}
                  {% for error in form.non_field_errors %}
                    <p style="margin: 0 0 0.5rem 0; font-size: 0.9rem;">{{ error }}</p>
                  {% endfor %}
                {% endif %}
              </div>
            {% endif %}

            <div style="margin-bottom: 1.5rem;">
              <label for="{{ form.new_password1.id_for_label }}" style="display: block; font-weight: 600; color: var(--text-dark); margin-bottom: 0.5rem; font-size: 1rem;">
                New Password
              </label>
              <input
                type="password"
                name="{{ form.new_password1.name }}"
                id="{{ form.new_password1.id_for_label }}"
                required
                style="width: 100%; padding: 1rem; border: 2px solid var(--border-color); border-radius: 8px; font-size: 1rem; transition: border-color 0.3s ease; box-sizing: border-box;"
                placeholder="Enter new password"
                onfocus="this.style.borderColor='var(--primary-green)'"
                onblur="this.style.borderColor='var(--border-color)'"
              >
              <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; color: var(--text-gray);">Password must be at least 8 characters long.</p>
            </div>

            <div style="margin-bottom: 2rem;">
              <label for="{{ form.new_password2.id_for_label }}" style="display: block; font-weight: 600; color: var(--text-dark); margin-bottom: 0.5rem; font-size: 1rem;">
                Confirm New Password
              </label>
              <input
                type="password"
                name="{{ form.new_password2.name }}"
                id="{{ form.new_password2.id_for_label }}"
                required
                style="width: 100%; padding: 1rem; border: 2px solid var(--border-color); border-radius: 8px; font-size: 1rem; transition: border-color 0.3s ease; box-sizing: border-box;"
                placeholder="Confirm new password"
                onfocus="this.style.borderColor='var(--primary-green)'"
                onblur="this.style.borderColor='var(--border-color)'"
              >
            </div>

            <button
              type="submit"
              class="btn btn-primary btn-block"
              style="width: 100%; padding: 1rem; font-size: 1.1rem; font-weight: 600; margin-bottom: 2rem;"
            >
              Set New Password
            </button>
          </form>
        {% else %}
          <!-- Invalid/Expired Link -->
          <div style="text-align: center;">
            <div style="background-color: #fee; border: 1px solid #fcc; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
              <i class="fas fa-exclamation-triangle" style="font-size: 2rem; color: #c33; margin-bottom: 1rem;"></i>
              <h3 style="color: #c33; font-weight: 600; margin-bottom: 0.5rem;">Invalid or Expired Link</h3>
              <p style="color: var(--text-gray); margin: 0;">This password reset link is invalid or has expired. Password reset links are valid for 3 days for security.</p>
            </div>

            <a href="{% url 'password_reset' %}" class="btn btn-primary" style="display: inline-block; padding: 0.75rem 2rem; text-decoration: none;">
              Request New Reset Link
            </a>
          </div>
        {% endif %}

        <div style="text-align: center; position: relative; margin: 2rem 0;">
          <div style="position: absolute; top: 50%; left: 0; right: 0; height: 1px; background: var(--border-color);"></div>
          <span style="background: var(--white); padding: 0 1rem; color: var(--text-gray); font-size: 0.9rem;">Remember your password?</span>
        </div>

        <div style="text-align: center;">
          <a href="{% url 'login' %}" class="btn btn-outline" style="display: inline-block; padding: 0.75rem 2rem; text-decoration: none;">
            Back to Login
          </a>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}
